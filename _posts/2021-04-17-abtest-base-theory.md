---
layout: post
title: "ABTest的前提和理论基础"
date: 2021-04-17
description: "ABTest前提和理论基础"
tag: 数据分析
mermaid: true
---

AB testing 是一个产品优化的可信赖的方法，也是确定**因果关系**的黄金准则

## 什么是AB Testing

为了某种优化目的，设置两个版本，让一组用户使用a版本，另一组用户使用b版本，这两个版本除了某一变量不同，其余均保持相同或相似，观察两个版本之间的指标差异从而判断优化效果。

在线上可以切出一部分用户（降低风险），完全随机的分成两组或多组（确保人群一致），一组保持现有的方案叫对照组，另外一组使用改进的方案叫实验组，使用统计的方法对两组之间指标差异进行分析，评估是否符合预期的一种方法。 

## 为什么要做AB Testing

1）防止风险：举个例子，如果一个产品目前盈利1000w，现在产品的小伙伴要上线一个新的功能，如果直接上线，（用户是全量，且你不知道用户是否喜欢这样的功能）导致盈利掉了500w，这时候已经发生亏损，这是公司不愿接受的。

2）评估每一改动对产品的影响：举个例子，小红和小明在新版本同时上线了一个feature，发布后线上留存大涨，小红和小明都认为是自己的feature提高了留存，两个人争执不休，通过ab test就能够避免这样的情形发生。

## AB Testing有效运行的条件

- 两个版本用户互不影响；

- 有足够的样本；

- OEC 关键指标是经过一致同意且能够在实验中被测量的；

- 改动容易实现的

## AB Testing的统计学原理

### 假设检验

假设总体参数，利用样本数据去检验假设是否正确。

![2021-04-17-abtest-base-theory1](/assets/2021-04-17-abtest-base-theory1.png)

有几个问题值得思考：

1. **在做AB Test的时候更推荐使用双侧检验**

   单侧检验（One-sided Test），它不仅在假设中说明了两个比较对象不同，并且还明确了谁大谁小，比如实验组的指标比对照组的指标大。

   双侧检验（Two-sided Test），指的是仅仅在假设中说明了两个比较对象不同，但是并没有明确谁大谁小。

   尽管双侧检验没有告诉明确谁大谁小，但是**大佬们的经验**提到：

   - 第一个原因是，双侧检验可以让数据自身在决策中发挥更大的作用。

     我们在实践中使用 A/B 测试，就是希望能够通过数据来驱动决策。我们要尽量减少在使用数据前产生的任何主观想法来干扰数据发挥作用。所以，双尾检验这种不需要我们明确谁大谁小的检验，更能发挥数据的作用。

   - 第二个原因是，双尾检验可以帮助我们全面考虑变化带来的正、负面结果。

     在实践中，我们期望改变可以使指标朝着好的方向变化，但是万一指标实际的变化与期望的正好相反呢？这就可以体现双尾检验的优势了。双尾检验可以同时照顾到正面和负面的结果，更接近多变的现实情况。但是单尾检验只会适用于其中一种，而且通常是我们期望的正面效果。所以正因为我们选择双尾测试，在备择假设中我们才只说了两组不同，并没有说谁大谁小。

2. **选择何种检验**

   - 当总体方差未知时，选取**t-test**
   - 当总体方差已知时，若样本量大于30选取**z-test**，否则选取**t-test**

   <font color = orange>在实际的AB Test中，一个比较有用的经验是：绝对值指标（均值类）用t-test；相对值指标（比例）用z-test </font>

   因为绝对指标的的总体方差，需要知道每一个用户的值，这个在AB实验中肯定不可能。而相对值指标是二项分布，可以通过样本量的值计算出总体的值，就如同10W人的某页面点击率是10%，随机从这10W人中抽样1W人，这个点击率也是10%一样。

   ![2021-04-17-abtest-base-theory2](/assets/2021-04-17-abtest-base-theory2.png)
   
3. **p-value**

   p值可以理解为对H0的支持度，当H0为真时，根据样本计算出来的概率，是**实际**的犯第一类错误的概率。在 A/B 测试的语境下，P 值就是当对照组和实验组指标事实上是相同时，在 A/B 测试中用样本数据所观测到的“实验组和对照组指标不同”出现的概率。

   而发生第一类错误的概率用α表示，也被称为显著水平（Significance Level）。“显著”是指错误发生的概率大，统计上把发生率小于 5% 的事件称为小概率事件，代表这类事件不容易发生。因此显著水平一般也为 5%。

### 指标的统计属性 

- 绝对值（均值类）指标，比如用户的平均使用时长、平均购买金额、平均购买频率，等等。
- 相对值（概率类）指标，比如用户点击的概率（点击率）、转化的概率（转化率）、购买的概率（购买率），等等。

<font color =orange>在数量足够大时，均值类指标服从正态分布；概率类指标本质上服从二项分布，但当数量足够大时，也服从正态分布。</font>

解释一下为什么概率类指标本质上服从二项分布：

业务中的概率类指标，具体到用户行为时，结果只有两种：要么发生，要么不发生。比如点击率，就是用来表征用户在线上点击特定内容的概率，一个用户要么点击，要么不点击，不会有第三种结果发生。这种只有两种结果的事件叫做二元事件（Binary Event）。二元事件在生活中很常见，比如掷硬币时只会出现正面或者反面这两种结果，所以统计学中有专门有一个描述二元事件概率分布的术语，也就是二项分布（Binomial Distribution）。这里我们还是结合着社交 App 的例子，来学习下二元分布。这款社交 App 在网上投放了广告，来吸引人们点击广告从而下载 App。现在我们想通过数据看看 App 下载率的分布情况：

下载率 = 通过广告下载 App 的用户数量 / 看到广告的用户数量。

因为单个二元事件的结果，只能是发生或者不发生，发生的概率要么是 100% 要么是 0%，所以我们要分析下载率就必须把数据进行一定程度的聚合。这里，我们就以分钟为单位来举例，先计算每分钟的下载率，再看它们的概率分布。我们有一个月的用户及下载数据，一个月一共有 43200 分钟（60 * 24 * 30），因为我们关注的是每分钟的下载率，所以一共有 43200 个数据点。通过数据分析发现，每分钟平均有 10 个人会看到广告，下载率集中分布在 0-30% 之间。

### 大数定理与中心极限定理

- 大数定理：概率是频率的稳定表现；样本的均值依概率收敛到总体的期望，说白了就是样本数量越多，越接近总体特征
- 中心极限定理：不管总体的分布是什么样的，样本的均值总是在总体均值附近上下波动，并且呈正态分布


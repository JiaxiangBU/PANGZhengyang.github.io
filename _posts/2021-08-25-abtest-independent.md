---
layout: post
title: "ABTest常见误区——实验组对照组独立性问题"
date: 2021-08-25
description: "ABTest实验组对照组独立性问题"
tag: 数据分析
katex: true
---

实验组和对照组相互独立是一个非常重要的问题，因为本质上AB Test是因果推断，所以只有在实验组和测试组相互独立，互不干扰的情况下，如果测试结果显著不同，那么才能把这个显著的不同归因为实验组和对照组的不同。

## 破坏两组独立性的表现形式

### 业务是社交网络 / 通讯类业务

这类业务主要是用户之间的交流和信息交换，典型代表包括微信、微博、领英（Linkedin）、语音 / 视频通讯、电子邮件，等等。

在这类业务中，会存在网络效应。网络效应也就是网络中相邻的各个节点会相互影响。如果节点 A 在实验组，而它相邻的节点 B 在对照组，这时候两者就不是独立的。

例如，某社交 App 改进了信息流的推荐算法，通过推荐给用户更相关的内容来增加用户的互动，现在呢，我们想通过 A/B 测试来检测算法改进的效果。

对照组：使用旧算法。
实验组：使用改进后的新算法。
评价指标：用户的平均使用时间。

假设实验组的用户 A 体验到了改进后的新算法，看到了更多喜欢的内容，就花了更多的时间在这个 App 上，同时也在 App 中分享了更多有趣的内容，和朋友有了更多的互动。而他的好友用户 B 恰巧在对照组，那么当 B 看到 A 分享的内容和互动后，可能也会花更多的时间在 App 中浏览，并且参与到和 A 的互动当中，即使 B 并没有体验到改进后的算法。

这就是一个典型的 A/B 测试中网络效应的例子。在实验组的用户 A 会因为 A/B 测试中的变化而改变使用行为，并且这个行为上的改变会通过网络效应传递给在对照组的好友 B，从而改变了用户 B 的使用行为，这就使得对照组也间接受到了实验组中新算法的影响。这显然违背了我们在对照组给用户旧算法体验的实验设计，所以测试结果很可能是两组的指标都升高，造成结果不准确。

### 共享经济业务

共享经济业务一般是双边市场，即公司提供平台，供给方和需求方。典型代表包括淘宝电商类、滴滴打车类、爱彼迎租房类等。在这类业务当中，由于供需关系是动态平衡的，一方的变化必然会引起另一方的变化，从而造成实验中两组相互影响。

比如说，我们在用 A/B 测试验证不同的优化是否有效时，往往只能一次验证一个优化。如果我们用 A/B 测试检验一个需求侧的优化，就要在需求侧分成实验组和对照组，这样实验组由于受到了优化，就会导致需求增加。那么在供给一定的情况下，更多的供给流向了实验组，就会造成对照组的供给减少，对照组的用户体验会变得更差，从而进一步打击对照组的需求。

假设某共享打车服务优化了用户在 App 中的打车流程，现在我们要通过 A/B 测试来验证这个优化是否有效果。这里，实验组依然是使用优化流程，对照组则使用旧流程。实验组的用户因为流程的优化，打车更加方便，吸引了更多的司机。而由于司机的数量是稳定的，这就会导致可供对照组选择的司机减少，对照组的用户更难打到车，用户体验变差，那么通过 A/B 测试得出的流程优化的效果相比较对照组就会被高估。

### 共享资源类业务

比较常见的业务包括广告营销这种有固定的的资源或者预算。

在营销预算固定的情况下，用AB Test来验证不同广告的效果，如果是燕子的效果更好，点击率更高，那么这就会付出更多的费用，从而导致对照组的广告预算变少。

## 如何避免破坏两组的独立性

### 从地理上进行分离

共享出行、共享租赁用的比较多。

最常用的是从城市维度进行分类。最好是两个城市/时长要尽量相似有可比性。

### 从资源上进行分离

针对共享资源。

具体操作就是AB Test每组的资源分配比例要和每组样本量的比例一致。

### 从时间上进行分离

适用于不易被用户察觉的变化上，如算法改进。

具体原理就是实验组和对照组都是同一组用户，在一段时间内实施变化，给他们实验组的体验，在另一段时间给他们对照组的体验。

